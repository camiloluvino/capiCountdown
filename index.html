<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador Capibara</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Lora:ital,wght@0,400;0,700;1,400&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/3d-forest.css">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>

    <!-- Intro Overlay -->
    <div id="intro-overlay"></div>
    <div class="stars"></div>
    <div class="clouds-container" id="cloudsContainer"></div>
    <div class="meadow"></div>
    <!-- Version footer removed per user request -->
    <button class="theme-toggle" id="themeToggle" title="Cambiar tema">ğŸŒ™</button>
    <button class="play-button" id="playButton" title="Jugar: La Cesta de Regalos">ğŸ§º</button>
    <button class="river-button" id="riverButton" title="Jugar: Cruzando el RÃ­o">ğŸŒŠ</button>

    <!-- Game Overlay (Cesta de Regalos) -->
    <div id="game-overlay">
        <div class="game-ui">
            <div class="score-total">Puntos: <span id="score">0</span></div>
            <div class="score-grid" id="scoreDetails">
                <!-- Dynamically populated -->
            </div>
        </div>
        <button class="game-close" id="closeGame">âœ•</button>
        <div id="game-player"></div>
        <!-- Items will be spawned here -->
    </div>

    <!-- River Game Overlay (Cruzando el RÃ­o) -->
    <div id="river-overlay">
        <button class="game-close" id="closeRiver">âœ•</button>

        <!-- River Game Area - Horizontal Layout -->
        <div id="river-game-area">
            <!-- Left Shore (Start) -->
            <div class="river-shore shore-left">
                <div class="shore-grass"></div>
            </div>

            <!-- The River -->
            <div class="river-water-horizontal"></div>

            <!-- Right Shore (Goal) -->
            <div class="river-shore shore-right">
                <div class="shore-grass"></div>
                <div class="shore-goal">ğŸŒº</div>
            </div>

            <!-- Player: Capybara with Turtle -->
            <div id="river-player">
                <img src="assets/images/capybara.png" class="river-capy" alt="Capibara">
                <img src="assets/images/tortuga-removebg-preview.png" class="river-turtle" alt="Tortuga">
            </div>

            <!-- Obstacles spawn here dynamically -->
        </div>

        <!-- UI Overlay -->
        <div class="river-ui-horizontal">
            <div class="stability-container-h">
                <span class="stability-label">ğŸ¢ Equilibrio</span>
                <div class="stability-bar-h">
                    <div class="stability-fill" id="stabilityFill"></div>
                </div>
            </div>
            <div class="progress-container">
                <span class="progress-label">Progreso</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="crosses-display">
                Cruces: <span id="crossCount">0</span> ğŸŒ¸
            </div>
        </div>

        <!-- Instructions -->
        <div id="river-hint">â†‘ â†“ Sube o baja para esquivar</div>
    </div>

    <!-- Feeding Menu -->
    <div class="feeding-menu">
        <div class="food-item" onclick="feedCapybara('ğŸŠ')">ğŸŠ</div>
        <div class="food-item" onclick="feedCapybara('ğŸ‰')">ğŸ‰</div>
        <div class="food-item" onclick="feedCapybara('ğŸŒ¿')">ğŸŒ¿</div>
        <div class="food-item" onclick="feedCapybara('ğŸ')">ğŸ</div>
    </div>

    <h1>Cuenta Regresiva Capibara</h1>
    <!-- Subtitle removed -->

    <div class="capybara-container">
        <img src="assets/images/capybara.png" alt="Capibara Zen" class="capybara-img" id="capyImage">
        <img src="assets/images/tortuga-removebg-preview.png" alt="Tortuga Sabia" class="turtle-img" id="turtleImage"
            style="display: none;">
    </div>

    <!-- Message of the Day -->
    <div class="message-box" id="dailyMessage">
        ...
    </div>

    <div class="counter-container" id="counter">
        <!-- Bundles generated here -->
    </div>

    <!-- Days text removed -->

    <!-- Hidden Time Travel for User Testing -->
    <details class="debug-panel">
        <summary>âš™ï¸ Viaje en el Tiempo (Debug)</summary>
        <div class="slider-container">
            <label for="timeTravel">Desliza para cambiar el dÃ­a:</label>
            <input type="range" id="timeTravel" min="0" max="60" step="1" value="0">
            <span id="debugDate">Fecha simulada: Hoy</span>
        </div>
        <div id="versionDisplay" style="margin-top: 20px; font-size: 0.9rem; color: #888;">Cargando versiÃ³n...</div>

        <!-- Admin Panel for Notes -->
        <details id="adminPanel" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
            <summary>ğŸ“ Admin Notas (God Mode)</summary>
            <button id="refreshAdminNotes" style="margin: 5px 0; font-size: 0.8rem;">ğŸ”„ Recargar Lista</button>
            <div id="adminNotesList" class="admin-list">
                <!-- Populated by JS -->
            </div>

            <!-- Hidden Edit Form -->
            <div id="adminEditForm" class="admin-edit-form hidden">
                <h4>Editar Nota</h4>
                <input type="hidden" id="editKey">
                <textarea id="editText" rows="3" placeholder="Contenido"></textarea>
                <input type="datetime-local" id="editTime">
                <div class="admin-actions">
                    <button id="saveEditBtn" class="save-btn">Guardar</button>
                    <button id="cancelEditBtn" class="cancel-btn">Cancelar</button>
                </div>
            </div>
        </details>
    </details>

    <!-- Notes Button (Now "Forest Walk") -->
    <button class="notes-button" id="notesButton" title="Paseo por el Bosque">ğŸŒ²</button>

    <!-- Notes Overlay -->
    <div id="notes-overlay">
        <div class="notes-container">
            <button class="notes-close" id="closeNotes">âœ•</button>
            <h2 class="notes-title">Diario Compartido</h2>
            <div class="notes-input-area">
                <textarea id="noteInput" placeholder="Escribe algo bonito..." maxlength="1000"></textarea>
                <button id="sendNote">Enviar</button>
            </div>
            <div id="notesList">
                <!-- Notes will appear here -->
            </div>
            <!-- BotÃ³n redundante para ir a 3D (para testeo) -->
            <button id="start-3d-btn"
                style="margin-top:10px; background:none; border:none;  font-size:1.5rem; cursor:pointer;"
                title="Paseo por el Bosque">ğŸŒ²</button>
        </div>
    </div>

    <!-- 3D Viewport -->
    <div id="forest-viewport">
        <div id="forest-fog"></div>
        <div id="forest-world">
            <div class="forest-floor"></div>
            <!-- Trees and Notes injected here -->
        </div>

        <!-- NEW: UI Note Button -->
        <button id="forest-add-note-btn" class="forest-ui-btn" title="Agregar nota">
            ğŸ“ Agregar Nota
        </button>

        <!-- Note Reading Modal -->
        <div id="note-reading-modal">
            <div class="modal-content">
                <span id="close-modal-btn">âœ•</span>
                <p id="modal-text"></p>
                <div id="modal-meta"></div>
            </div>
        </div>

        <!-- Note WRITING Modal (New) -->
        <div id="note-writing-modal">
            <div class="modal-content">
                <span id="close-write-modal-btn">âœ•</span>
                <h3>Nueva Nota</h3>
                <textarea id="write-modal-input" placeholder="Deja tu huella en el bosque..."
                    maxlength="1000"></textarea>
                <button id="write-modal-save">Clavar en el Ã¡rbol ğŸ“Œ</button>
            </div>
        </div>

        <div id="nav-hint">Usa la rueda del ratÃ³n o desliza para caminar</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script src="js/3d-forest.js"></script>
    <script src="js/script.js"></script>
</body>

</html>